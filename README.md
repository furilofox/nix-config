# Beginner-friendly NixOS Flake

Generated by Claude 3.7 as a basis to get me started

This is a minimalist, yet powerful NixOS configuration template using the Flake system. It's designed to be beginner-friendly while following best practices and using modern NixOS features.

## Features

- Flake-based structure for reproducible builds
- Home Manager integration (as a NixOS module)
- Modular design for both system and user configurations
- Support for multiple hosts and users
- Easy switching between stable (24.11) and unstable packages
- Clear options system for enabling/disabling features
- Minimal boilerplate for better understanding

## Getting Started

### Prerequisites

- NixOS installed with flakes enabled
- Git

### Initial Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/yourusername/nixos-config.git
   cd nixos-config
   ```

2. Generate hardware configuration for your system:
   ```bash
   # Replace 'laptop' with your preferred hostname
   sudo nixos-generate-config --show-hardware-config > hosts/laptop/hardware.nix
   ```

3. Edit the host configuration at `hosts/laptop/default.nix` to match your needs

4. Apply the configuration:
   ```bash
   sudo nixos-rebuild switch --flake .#laptop
   ```

### Directory Structure

```
.
├── flake.nix                 # Main flake configuration
├── hosts/                    # Host-specific configurations
├── users/                    # User-specific configurations
├── modules/                  # Shared modules (NixOS and Home Manager)
└── lib/                      # Helper functions
```

## Host Configuration

Each host has its own directory under `hosts/`. The main configuration is in `default.nix`, with additional files for hardware and networking.

To add a new host:

1. Create a new directory under `hosts/`:
   ```bash
   mkdir -p hosts/newhost
   ```

2. Create the necessary configuration files:
   ```
   hosts/newhost/default.nix
   hosts/newhost/hardware.nix
   hosts/newhost/networking.nix
   ```

3. Add the new host to `flake.nix`:
   ```nix
   nixosConfigurations = {
     # ...existing hosts...
     newhost = mkHost "newhost" [ ];
   };
   ```

## User Configuration

Users are defined in the `users/` directory. Each user can have different configurations for different hosts.

To add a new user:

1. Create a new directory under `users/`:
   ```bash
   mkdir -p users/newuser
   ```

2. Create the necessary configuration files:
   ```
   users/newuser/default.nix   # Common user config
   users/newuser/laptop.nix    # Host-specific user config
   ```

3. Add the user to your host configuration in `hosts/laptop/default.nix`:
   ```nix
   imports = [
     # ...other imports...
     ../../users/newuser/laptop.nix
   ];
   
   # Add user account
   users.users.newuser = {
     isNormalUser = true;
     description = "New User";
     extraGroups = [ "wheel" "networkmanager" ];
   };
   ```

## Using Modules

Modules are organized under `modules/`:
- `modules/nixos/` - System-level modules
- `modules/home-manager/` - User-level modules

To use a module, import it and enable it in your configuration:

```nix
# In your host or user configuration
custom.fonts.enable = true;
custom.fonts.extraFonts = with pkgs; [ ubuntu_font_family ];

# For home-manager modules
custom.programs.vscode = {
  enable = true;
  extensions = [ "ms-python.python" ];
  userSettings = {
    "editor.formatOnSave" = true;
  };
};
```

## Using Unstable Packages

The template provides easy access to unstable packages:

```nix
# In a home-manager config
home.packages = with pkgs; [
  # Regular stable packages
  git
  htop
  
  # Single unstable package
  (lib.custom.pkgsUnstable.pkg "neovim")
  
  # Multiple unstable packages
  (lib.custom.pkgsUnstable.pkgs [
    "firefox"
    "vscode"
  ])
];
```

## Updating

To update your system:

```bash
# Update flake inputs
nix